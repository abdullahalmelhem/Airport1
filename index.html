<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø³Ø§Ø­Ø© Ø§Ù„Ø·ÙŠØ±Ø§Ù† - ØªÙ‚Ø±ÙŠØ± Ø®Ø¯Ù…Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --bg0:#041c1a;
      --bg1:#062a26;
      --line: rgba(255,255,255,.10);
      --gold:#b9a779;
      --gold2:#988561;
      --txt:#e9e6dc;
      --muted:#8fb3ad;
    }

    body{
      font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Arial;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(185,167,121,.12), transparent 55%),
        radial-gradient(900px 500px at 80% 20%, rgba(66,129,119,.14), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color: var(--txt);
      min-height:100vh;
    }

    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      backdrop-filter: blur(10px);
    }

    .card{
      background: linear-gradient(180deg, rgba(7,47,42,.92), rgba(6,42,38,.92));
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(0,0,0,.35);
    }

    .section{
      border: 1px solid var(--line);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(8,58,51,.55), rgba(7,47,42,.25));
    }

    .label{
      color: var(--gold);
      font-weight: 700;
      font-size: 12px;
      margin-bottom: 6px;
      display:block;
    }

    .inp, .ta{
      width:100%;
      background: rgba(4,28,26,.55);
      border: 1px solid rgba(143,179,173,.28);
      color: var(--txt);
      border-radius: 12px;
      padding: 12px 12px;
      outline:none;
      transition: .15s;
    }
    .inp:focus, .ta:focus{
      border-color: rgba(185,167,121,.65);
      box-shadow: 0 0 0 3px rgba(185,167,121,.14);
    }
    .ta{ min-height: 96px; resize: vertical; }

    .chip{
      border: 1px solid rgba(185,167,121,.35);
      background: rgba(185,167,121,.08);
      padding: 8px 10px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 12px;
      display: inline-block;
    }

    .btn{
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 800;
      transition: .15s;
      display:flex; align-items:center; justify-content:center; gap:10px;
      user-select:none;
    }
    .btn-gold{
      background: linear-gradient(180deg, var(--gold), var(--gold2));
      color: #06201d;
      box-shadow: 0 10px 24px rgba(185,167,121,.18);
    }
    .btn-gold:hover{ filter: brightness(1.03); transform: translateY(-1px); }

    .btn-dark{
      background: rgba(4,28,26,.55);
      color: var(--gold);
      border: 1px solid rgba(185,167,121,.45);
    }
    .btn-dark:hover{ background: rgba(0,0,0,.25); }

    .btn-soft{
      background: rgba(8,58,51,.40);
      border: 1px solid rgba(143,179,173,.28);
      color: var(--txt);
    }
    .btn-soft:hover{ background: rgba(8,58,51,.55); }

    .mini{ color: var(--muted); font-size: 12px; }

    .divider{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(185,167,121,.30), transparent);
    }

    /* ========= Custom Dropdown ========= */
    .select-wrap{ position:relative; }

    .select-btn{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding-left: 52px;
      cursor:pointer;
    }
    .select-btn .left-icons{
      position:absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      display:flex;
      align-items:center;
      gap:10px;
      pointer-events:none;
      opacity:.98;
    }
    .select-btn .plane{
      color: rgba(185,167,121,.95);
      font-size: 14px;
      transform: translateY(-1px);
    }
    .select-btn .chev{
      width: 10px;
      height: 10px;
      border-left: 2px solid rgba(185,167,121,.95);
      border-bottom: 2px solid rgba(185,167,121,.95);
      transform: rotate(-45deg);
      transition: .15s;
      opacity:.95;
    }
    .select-wrap.open .select-btn{
      border-color: rgba(185,167,121,.70);
      box-shadow: 0 0 0 3px rgba(185,167,121,.14);
      background: rgba(4,28,26,.62);
    }
    .select-wrap.open .select-btn .chev{ transform: rotate(135deg); }

    .select-menu{
      position:absolute;
      z-index: 50;
      width: 100%;
      margin-top: 10px;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(185,167,121,.22);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      backdrop-filter: blur(12px);
      box-shadow: 0 18px 55px rgba(0,0,0,.45);
      animation: pop .12s ease-out;
    }
    @keyframes pop{
      from{ opacity:0; transform: translateY(-4px) scale(.99); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .select-search{
      border-radius: 0;
      border: 0;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(4,28,26,.45);
      padding: 12px 14px;
    }
    .select-search:focus{
      box-shadow:none;
      border-bottom: 1px solid rgba(185,167,121,.45);
    }

    .select-list{
      max-height: 260px;
      overflow:auto;
      padding: 8px;
    }
    .select-item{
      width:100%;
      text-align:right;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: rgba(4,28,26,.25);
      color: var(--txt);
      font-weight: 800;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      transition: .12s;
      cursor:pointer;
      user-select:none;
    }
    .select-item:hover{
      background: rgba(185,167,121,.12);
      border-color: rgba(185,167,121,.28);
    }
    .select-item .tick{
      opacity:0;
      color: rgba(185,167,121,.95);
      font-weight: 900;
    }
    .select-item.selected{
      background: linear-gradient(180deg, rgba(185,167,121,.18), rgba(185,167,121,.08));
      border-color: rgba(185,167,121,.35);
    }
    .select-item.selected .tick{ opacity:1; }

    .select-empty{
      padding: 12px;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
    }

    .hidden{ display:none !important; }

    /* ========= Services â€“ Pro Cards ========= */
    .svcGrid{
      display:grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 10px;
    }
    @media (min-width: 640px){
      .svcGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (min-width: 1024px){
      .svcGrid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    .svcCard{
      border: 1px solid rgba(143,179,173,.26);
      background: linear-gradient(180deg, rgba(4,28,26,.50), rgba(4,28,26,.28));
      border-radius: 16px;
      padding: 12px 12px;
      transition: .12s;
      position: relative;
      overflow: hidden;
    }
    .svcCard::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(400px 120px at 20% 0%, rgba(185,167,121,.12), transparent 60%);
      opacity:.85;
      pointer-events:none;
    }
    .svcCard:hover{ border-color: rgba(185,167,121,.35); transform: translateY(-1px); }

    .svcHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      position: relative;
      z-index: 1;
    }
    .svcName{
      font-weight: 900;
      color: var(--txt);
      font-size: 13px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .svcIcon{
      width: 28px;
      height: 28px;
      border-radius: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      border: 1px solid rgba(185,167,121,.28);
      background: rgba(185,167,121,.08);
      color: rgba(185,167,121,.95);
      font-size: 14px;
      flex: 0 0 auto;
    }

    .svcToggle{
      display:flex;
      align-items:center;
      gap:10px;
      position: relative;
      z-index: 1;
    }
    .svcToggle input[type="checkbox"]{
      width: 20px;
      height: 20px;
      accent-color: var(--gold);
    }

    .svcQtyRow{
      margin-top: 10px;
      position: relative;
      z-index: 1;
      display:flex;
      align-items:center;
      gap: 10px;
      justify-content:space-between;
    }
    .svcQtyRow .mini{ margin:0; }
    .svcQty{
      width: 110px;
      text-align:center;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(4,28,26,.55);
      border: 1px solid rgba(143,179,173,.28);
      color: var(--txt);
      outline:none;
      transition:.15s;
    }
    .svcQty:focus{
      border-color: rgba(185,167,121,.65);
      box-shadow: 0 0 0 3px rgba(185,167,121,.14);
    }

    @media print{
      body{
        background: #062a26 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .no-print{ display:none !important; }
      .card{ box-shadow:none !important; }
    }

    /* ===== Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„ØªØµØ¯ÙŠØ± ÙƒÙ€ PDF ===== */
    #pdfRoot{
      position: absolute;
      top: 0;
      right: 0; 
      width: 1100px;
      direction: rtl;
      font-family: 'Tajawal', Arial, sans-serif;
      color: #000000;
      z-index: -9999;
      opacity: 0.01;
      pointer-events: none;
    }
    .pdfPage{
      background: #ffffff;
      padding: 10px;
    }
    .pdfHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 16px;
      border-radius: 14px;
      padding: 18px 20px;
      background: #0b2f2a;
      color:#fff;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
      page-break-inside: avoid;
    }
    .pdfHeader h1{
      margin:0;
      font-size: 24px;
      font-weight: 900;
      line-height: 1.3;
    }
    .pdfHeader .sub{
      margin-top: 6px;
      font-size: 14px;
      opacity: .9;
    }
    .pdfBadge{
      display:inline-block;
      background: rgba(255,255,255,.1);
      border: 1px solid rgba(255,255,255,.3);
      color: #ffffff;
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 14px;
      white-space: nowrap;
    }
    
    .pdfGrid{
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    
    .pdfCard{
      border: 2px solid #cbd5e1;
      border-radius: 14px;
      overflow:hidden;
      page-break-inside: avoid;
      break-inside: avoid;
      background: #ffffff;
    }
    .pdfCardTitle{
      background: #f1f5f9;
      color:#0f172a;
      padding: 14px 18px;
      font-weight: 900;
      font-size: 18px;
      border-bottom: 2px solid #cbd5e1;
    }
    .pdfCardBody{
      padding: 14px 18px;
    }
    .pdfTable{
      width:100%;
      border-collapse: collapse;
      font-size: 15px;
    }
    .pdfTable tr {
      page-break-inside: avoid;
      break-inside: avoid;
    }
    .pdfTable td{
      border: 1px solid #cbd5e1;
      padding: 12px 14px;
      vertical-align: middle;
    }
    .k{
      background: #f8fafc;
      color:#334155;
      font-weight: 800;
      white-space: nowrap;
      font-size: 14px;
    }
    .v{
      color:#000000;
      font-weight: 900;
      font-size: 16px;
    }
    .pdfChips{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }
    .pdfChip{
      border: 1px solid #94a3b8;
      background: #e2e8f0;
      color: #0f172a;
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 14px;
      direction: rtl; 
    }
    .pdfNotes{
      white-space: pre-wrap;
      font-size: 15px;
      font-weight: 800;
      color: #000000;
      line-height: 1.6;
      border: 1px solid #cbd5e1;
      padding: 12px;
      border-radius: 8px;
      background: #f8fafc;
      margin-top: 8px;
    }
  </style>
</head>

<body class="p-4 sm:p-6">
  <div class="mx-auto max-w-4xl card overflow-hidden">
    <div class="p-5 sm:p-6 glass no-print">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <div class="flex items-center gap-3">
          <img src="logo.png" onerror="this.style.display='none'" class="w-12 h-12 object-contain">
          <div>
            <div class="text-[11px] text-[color:var(--gold)] font-extrabold tracking-wide">Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</div>
            <div class="text-base sm:text-lg font-extrabold">Ø³Ø§Ø­Ø© Ø§Ù„Ø·ÙŠØ±Ø§Ù† - Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø±ÙŠØ± Ø®Ø¯Ù…Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</div>
          </div>
        </div>

        <div class="flex flex-wrap gap-2">
          <button id="exportWordBtn" class="btn btn-dark" onclick="exportDocxNative()">ØªØµØ¯ÙŠØ± ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Word</button>
          <button id="exportPdfBtn" class="btn btn-gold" onclick="exportPdfPro()">ØªØµØ¯ÙŠØ± ÙˆÙ…Ø´Ø§Ø±ÙƒØ© PDF</button>
          <button class="btn btn-dark" onclick="resetForm()">ØªÙØ±ÙŠØº</button>
        </div>
      </div>
    </div>

    <div class="p-4 sm:p-6">
      <div class="grid grid-cols-1 gap-4">
        <div class="space-y-4">
          <div class="section p-4 sm:p-5">
            <div class="flex items-center justify-between gap-3 mb-3">
              <div class="text-[color:var(--gold)] font-extrabold">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©</div>
              <span class="mini">Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ù‚Ù… Ø¨ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span>
            </div>
            <div class="divider mb-4"></div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="label">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù†ØµØ± (Ø§Ø³Ù… ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±)</label>
                <input id="rep_writer" class="inp" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
              </div>

              <div>
                <label class="label">Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</label>

                <input id="aircraft_type" type="hidden" value="">

                <div id="aircraftSelect" class="select-wrap">
                  <button id="aircraft_btn" type="button" class="inp select-btn" aria-haspopup="listbox" aria-expanded="false">
                    <span id="aircraft_btn_text">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©...</span>
                    <span class="left-icons">
                      <span class="plane">âœˆ</span>
                      <span class="chev"></span>
                    </span>
                  </button>

                  <div id="aircraft_menu" class="select-menu hidden" role="listbox" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©">
                    <input id="aircraft_search" class="inp select-search" type="text" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹...">
                    <div id="aircraft_list" class="select-list"></div>
                    <div id="aircraft_empty" class="select-empty hidden">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>
                  </div>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-2 sm:col-span-2">
                <div>
                  <label class="label">ØªÙˆÙ‚ÙŠØª Ø§Ù„ÙˆØµÙˆÙ„ (ØªØ§Ø±ÙŠØ®)</label>
                  <input id="arr_date" class="inp" type="date">
                </div>
                <div>
                  <label class="label">ØªÙˆÙ‚ÙŠØª Ø§Ù„ÙˆØµÙˆÙ„ (ÙˆÙ‚Øª)</label>
                  <input id="arr_time" class="inp" type="time">
                </div>
              </div>

              <div class="grid grid-cols-2 gap-2 sm:col-span-2">
                <div>
                  <label class="label">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© (ØªØ§Ø±ÙŠØ®)</label>
                  <input id="dep_date" class="inp" type="date">
                </div>
                <div>
                  <label class="label">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© (ÙˆÙ‚Øª)</label>
                  <input id="dep_time" class="inp" type="time">
                </div>
              </div>

              <div class="sm:col-span-2">
                <label class="label">Ù…Ù‡Ø¨Ø· Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</label>
                <div class="grid grid-cols-2 gap-2">
                  <input id="stand_num" class="inp" type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙÙ†ÙƒØ±">
                  <input id="gate_num" class="inp" type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©">
                </div>
              </div>

              <div class="sm:col-span-2">
                <label class="label">Ø±Ù‚Ù… Ø§Ù„Ø±Ø­Ù„Ø©</label>
                <div class="grid grid-cols-2 gap-2">
                  <input id="flight_arr" class="inp" type="text" placeholder="Ù‚Ø¯ÙˆÙ…">
                  <input id="flight_dep" class="inp" type="text" placeholder="Ù…ØºØ§Ø¯Ø±Ø©">
                </div>
              </div>

              <div>
                <label class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨</label>
                <input id="pax_count" class="inp" type="number" min="0" placeholder="0">
              </div>

              <div>
                <label class="label">ÙˆÙÙˆØ¯ (Ø¹Ø¯Ø¯)</label>
                <input id="delegations_count" class="inp" type="number" min="0" placeholder="0">
              </div>

              <div class="sm:col-span-2">
                <label class="label">Ø±ÙƒØ§Ø¨ VIP (Ø¹Ø¯Ø¯)</label>
                <input id="vip_pax" class="inp" type="number" min="0" placeholder="0">
              </div>
            </div>
          </div>

          <div class="section p-4 sm:p-5">
            <div class="flex items-center justify-between gap-3 mb-3">
              <div class="text-[color:var(--gold)] font-extrabold">Ø§Ù„Ø·ÙˆØ§Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† + Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø§Øª</div>
              <span class="mini">ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ø³Ù… Ù„ÙƒÙ„ Ø¨Ù†Ø¯</span>
            </div>
            <div class="divider mb-4"></div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
              <div class="glass rounded-2xl p-3 border border-[color:var(--line)]">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-[color:var(--gold)] font-bold">Ù…ÙˆØ¸Ù Ø§Ù„Ø­Ø±ÙƒØ©</div>
                  <button class="btn btn-dark !py-2 !px-3 !rounded-xl text-xs" type="button" onclick="addPerson('movement_staff')">+ Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="movement_staff" class="space-y-2"></div>
              </div>

              <div class="glass rounded-2xl p-3 border border-[color:var(--line)]">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-[color:var(--gold)] font-bold">Ø¹Ù…Ø§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>
                  <button class="btn btn-dark !py-2 !px-3 !rounded-xl text-xs" type="button" onclick="addPerson('loading_staff')">+ Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="loading_staff" class="space-y-2"></div>
              </div>

              <div class="glass rounded-2xl p-3 border border-[color:var(--line)]">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-[color:var(--gold)] font-bold">Ø¶ÙŠØ§ÙØ© Ø¬ÙˆÙŠØ©</div>
                  <button class="btn btn-dark !py-2 !px-3 !rounded-xl text-xs" type="button" onclick="addPerson('food_staff')">+ Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="food_staff" class="space-y-2"></div>
              </div>

              <div class="glass rounded-2xl p-3 border border-[color:var(--line)]">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-[color:var(--gold)] font-bold">Ø¹Ù…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
                  <button class="btn btn-dark !py-2 !px-3 !rounded-xl text-xs" type="button" onclick="addPerson('maintenance_staff')">+ Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="maintenance_staff" class="space-y-2"></div>
              </div>

              <div class="glass rounded-2xl p-3 border border-[color:var(--line)]">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-[color:var(--gold)] font-bold">Ø¹Ù…Ø§Ù„ Ø§Ù„ÙƒØ§ØªØ±ÙŠÙ†Øº</div>
                  <button class="btn btn-dark !py-2 !px-3 !rounded-xl text-xs" type="button" onclick="addPerson('catering_staff')">+ Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="catering_staff" class="space-y-2"></div>
              </div>

              <div class="glass rounded-2xl p-3 border border-[color:var(--line)]">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-[color:var(--gold)] font-bold">Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³Ø§Ø¯ÙƒÙˆØ¨</div>
                  <button class="btn btn-dark !py-2 !px-3 !rounded-xl text-xs" type="button" onclick="addPerson('sadkoub_staff')">+ Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="sadkoub_staff" class="space-y-2"></div>
              </div>
            </div>

            <div class="mt-3">
              <label class="label">Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø§Øª Ø§Ù„ØªÙŠ ÙˆÙØ¬Ø¯Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</label>
              <textarea id="found_items" class="ta" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø§Øª Ø¥Ù† ÙˆØ¬Ø¯Øª..."></textarea>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-3">
              <div>
                <label class="label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                <input id="receiver_name" class="inp" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…">
              </div>
            </div>
          </div>

          <div class="section p-4 sm:p-5">
            <div class="flex items-center justify-between gap-3 mb-3">
              <div class="text-[color:var(--gold)] font-extrabold">Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø©</div>
              <span class="mini">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙˆØ§Ù…Ù„Ø£ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©</span>
            </div>
            <div class="divider mb-4"></div>

            <div id="svcGrid" class="svcGrid">
              <div class="svcCard" data-svc="lift">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">âš™</span> Ø±Ø§ÙØ¹Ø©</div>
                  <div class="svcToggle"><input id="svc_lift" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="catering">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ½</span> ÙƒØ§ØªØ±ÙŠÙ†Øº</div>
                  <div class="svcToggle"><input id="svc_catering1" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="fire">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ§¯</span> Ø¥Ø·ÙØ§Ø¦ÙŠØ©</div>
                  <div class="svcToggle"><input id="svc_fire" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="compressor">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ§°</span> Ø§Ù„Ø¶Ø§ØºØ·</div>
                  <div class="svcToggle"><input id="svc_compressor" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="battery">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ”‹</span> Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</div>
                  <div class="svcToggle"><input id="svc_battery" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="ac">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">â„</span> Ø®Ø¯Ù…Ø© Ù…ÙƒÙŠÙ</div>
                  <div class="svcToggle"><input id="svc_ac" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="fresh">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ’§</span> Ù…ÙŠØ§Ù‡ Ø­Ù„ÙˆØ©</div>
                  <div class="svcToggle"><input id="svc_fresh_water" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="salt">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ§‚</span> Ù…ÙŠØ§Ù‡ Ù…Ø§Ù„Ø­Ø©</div>
                  <div class="svcToggle"><input id="svc_salt_water" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="sadcup">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ§ª</span> Ø³Ø§Ø¯ ÙƒÙˆØ¨</div>
                  <div class="svcToggle"><input id="svc_sad_cup" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="beltStairsQty">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸªœ</span> Ø³Ù„Ù… Ø§Ù„Ù‚Ø´Ø§Ø· (Ø¹Ø¯Ø¯)</div>
                </div>
                <div class="svcQtyRow">
                  <span class="mini">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯</span>
                  <input id="svc_belt_stairs_qty" class="svcQty" type="number" min="0" placeholder="0">
                </div>
              </div>

              <div class="svcCard" data-svc="paxStairsQty">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸªœ</span> Ø³Ù„Ø§Ù„Ù… Ø±ÙƒØ§Ø¨ (Ø¹Ø¯Ø¯)</div>
                </div>
                <div class="svcQtyRow">
                  <span class="mini">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯</span>
                  <input id="svc_stairs_qty" class="svcQty" type="number" min="0" placeholder="0">
                </div>
              </div>

              <div class="svcCard" data-svc="cartsQty">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ§³</span> Ø¹Ø±Ø¨Ø§Øª (Ø¹Ø¯Ø¯)</div>
                </div>
                <div class="svcQtyRow">
                  <span class="mini">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯</span>
                  <input id="svc_carts_qty" class="svcQty" type="number" min="0" placeholder="0">
                </div>
              </div>

              <div class="svcCard" data-svc="chargeQty">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">âš¡</span> Ø´Ø­Ù† (Ø¹Ø¯Ø¯)</div>
                </div>
                <div class="svcQtyRow">
                  <span class="mini">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯</span>
                  <input id="svc_charge_qty" class="svcQty" type="number" min="0" placeholder="0">
                </div>
              </div>

              <div class="svcCard" data-svc="tractorQty">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸšœ</span> Ø¬Ø±Ø§Ø± (Ø¹Ø¯Ø¯)</div>
                </div>
                <div class="svcQtyRow">
                  <span class="mini">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯</span>
                  <input id="svc_tractor_qty" class="svcQty" type="number" min="0" placeholder="0">
                </div>
              </div>

              <div class="svcCard" data-svc="pushback">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ›</span> Ø¨ÙˆØ´ Ø¨Ø§Ùƒ</div>
                  <div class="svcToggle"><input id="svc_pushback" type="checkbox"></div>
                </div>
              </div>

              <div class="svcCard" data-svc="loader">
                <div class="svcHead">
                  <div class="svcName"><span class="svcIcon">ğŸ—</span> Ù„ÙˆØ¯Ø±</div>
                  <div class="svcToggle"><input id="svc_loader" type="checkbox"></div>
                </div>
              </div>
            </div>

            <div class="mt-4 glass rounded-2xl p-3 border border-[color:var(--line)]">
              <div class="text-[color:var(--gold)] font-bold mb-2">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥Ù†Ø§Ø±Ø©</div>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                <div>
                  <label class="label">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</label>
                  <input id="light_duration" class="inp" type="text" placeholder="Ù…Ø«Ø§Ù„: 25 Ø¯Ù‚ÙŠÙ‚Ø©">
                </div>
                <div>
                  <label class="label">Ø±Ù‚Ù… Ø§Ù„Ù…Ù‡Ø¨Ø·</label>
                  <input id="light_stand" class="inp" type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ù‡Ø¨Ø·">
                </div>
              </div>
            </div>

            <div class="mt-3">
              <label class="label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
              <textarea id="notes" class="ta" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="pdfRoot" aria-hidden="true">
    <div id="pdfPage" class="pdfPage"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <script>
    // ===== Helpers =====
    function setTodayDefaults(){
      const today = new Date().toISOString().split('T')[0];
      if(!document.getElementById('arr_date').value) document.getElementById('arr_date').value = today;
      if(!document.getElementById('dep_date').value) document.getElementById('dep_date').value = today;
    }

    function escapeHtml(s){
      return (s ?? '').toString()
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }

    function addPerson(containerId){
      const container = document.getElementById(containerId);
      const row = document.createElement('div');
      row.className = "flex gap-2 items-center";
      row.innerHTML = `
        <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" class="inp !py-2 !rounded-xl flex-1">
        <button type="button" class="btn btn-soft !py-2 !px-3 !rounded-xl text-xs" title="Ø­Ø°Ù">Ø­Ø°Ù</button>
      `;
      row.querySelector('button').onclick = () => row.remove();
      container.appendChild(row);
    }

    function getPeople(containerId){
      const container = document.getElementById(containerId);
      const inputs = Array.from(container.querySelectorAll('input[type="text"]'));
      return inputs.map(i => i.value.trim()).filter(Boolean);
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø¨Ø´ÙƒÙ„ Ø¬Ø¯ÙˆÙ„ Ø´Ø§Ù‚ÙˆÙ„ÙŠ/Ø¹Ù…ÙˆØ¯ÙŠ
    function getVerticalStaffRows(d) {
      const maxLen = Math.max(
        d.movement_staff.length, d.loading_staff.length, d.food_staff.length,
        d.maintenance_staff.length, d.catering_staff.length, d.sadkoub_staff.length
      );
      const rows = [];
      for(let i=0; i<maxLen; i++){
        rows.push({
          movement: d.movement_staff[i] || "",
          loading: d.loading_staff[i] || "",
          food: d.food_staff[i] || "",
          maintenance: d.maintenance_staff[i] || "",
          catering: d.catering_staff[i] || "",
          sadkoub: d.sadkoub_staff[i] || ""
        });
      }
      return rows;
    }

    function n0(id){
      const v = document.getElementById(id)?.value;
      const num = parseInt((v ?? "").toString(), 10);
      return isNaN(num) ? 0 : Math.max(0, num);
    }

    function yn(id){
      return !!document.getElementById(id)?.checked;
    }

    const SVC_ALL = [
      "lift","catering","fire","compressor","battery","ac","fresh","salt","sadcup",
      "beltStairsQty","paxStairsQty","cartsQty","chargeQty","tractorQty","pushback","loader"
    ];

    const SVC_FLYDUBAI = ["lift","beltStairsQty","paxStairsQty","cartsQty"];
    const SVC_FLYADEIL_NAS = ["beltStairsQty","paxStairsQty","cartsQty"];

    function getAircraftRuleSet(aircraftType){
      const t = (aircraftType || "").trim();
      if(t === "ÙÙ„Ø§ÙŠ Ø¯Ø¨ÙŠ") return new Set(SVC_FLYDUBAI);
      if(t === "ÙÙ„Ø§ÙŠ Ø£Ø¯ÙŠÙ„" || t === "ÙÙ„Ø§ÙŠ Ù†Ø§Ø³") return new Set(SVC_FLYADEIL_NAS);
      return new Set(SVC_ALL);
    }

    function clearHiddenServiceValues(allowedSet){
      const checkMap = {
        lift: "svc_lift", catering: "svc_catering1", fire: "svc_fire",
        compressor: "svc_compressor", battery: "svc_battery", ac: "svc_ac",
        fresh: "svc_fresh_water", salt: "svc_salt_water", sadcup: "svc_sad_cup",
        pushback: "svc_pushback", loader: "svc_loader",
      };
      Object.entries(checkMap).forEach(([key, id]) => {
        if(!allowedSet.has(key)){
          const el = document.getElementById(id);
          if(el) el.checked = false;
        }
      });

      const qtyMap = {
        beltStairsQty: "svc_belt_stairs_qty", paxStairsQty: "svc_stairs_qty",
        cartsQty: "svc_carts_qty", chargeQty: "svc_charge_qty", tractorQty: "svc_tractor_qty",
      };
      Object.entries(qtyMap).forEach(([key, id]) => {
        if(!allowedSet.has(key)){
          const el = document.getElementById(id);
          if(el) el.value = "";
        }
      });
    }

    function applyServiceVisibility(){
      const aircraft = (document.getElementById('aircraft_type').value || "").trim();
      const allowed = getAircraftRuleSet(aircraft);

      const cards = Array.from(document.querySelectorAll('#svcGrid .svcCard[data-svc]'));
      cards.forEach(card => {
        const key = card.getAttribute('data-svc');
        if(allowed.has(key)) card.classList.remove('hidden');
        else card.classList.add('hidden');
      });
      clearHiddenServiceValues(allowed);
    }

    function isSvcVisible(key){
      const card = document.querySelector(`#svcGrid .svcCard[data-svc="${key}"]`);
      if(!card) return true;
      return !card.classList.contains('hidden');
    }

    function gatherServices(){
      const chips = [];
      const addCheck = (label, id, key) => {
        if(!isSvcVisible(key)) return;
        if(yn(id)) chips.push(label);
      };
      const addQty = (label, id, key) => {
        if(!isSvcVisible(key)) return;
        const q = n0(id);
        if(q > 0) chips.push(`${label} (${q})`);
      };

      addCheck("Ø±Ø§ÙØ¹Ø©", "svc_lift", "lift");
      addCheck("ÙƒØ§ØªØ±ÙŠÙ†Øº", "svc_catering1", "catering");
      addCheck("Ø§Ù„Ø¶Ø§ØºØ·", "svc_compressor", "compressor");
      addCheck("Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©", "svc_battery", "battery");
      addCheck("Ù…ÙŠØ§Ù‡ Ù…Ø§Ù„Ø­Ø©", "svc_salt_water", "salt");
      addCheck("Ù…ÙŠØ§Ù‡ Ø­Ù„ÙˆØ©", "svc_fresh_water", "fresh");
      addCheck("Ø³Ø§Ø¯ ÙƒÙˆØ¨", "svc_sad_cup", "sadcup");
      addCheck("Ø®Ø¯Ù…Ø© Ù…ÙƒÙŠÙ", "svc_ac", "ac");
      addCheck("Ø¥Ø·ÙØ§Ø¦ÙŠØ©", "svc_fire", "fire");

      addQty("Ø³Ù„Ù… Ø§Ù„Ù‚Ø´Ø§Ø·", "svc_belt_stairs_qty", "beltStairsQty");
      addQty("Ø³Ù„Ø§Ù„Ù… Ø±ÙƒØ§Ø¨", "svc_stairs_qty", "paxStairsQty");
      addQty("Ø¹Ø±Ø¨Ø§Øª", "svc_carts_qty", "cartsQty");
      addQty("Ø´Ø­Ù†", "svc_charge_qty", "chargeQty");
      addQty("Ø¬Ø±Ø§Ø±", "svc_tractor_qty", "tractorQty");

      addCheck("Ø¨ÙˆØ´ Ø¨Ø§Ùƒ", "svc_pushback", "pushback");
      addCheck("Ù„ÙˆØ¯Ø±", "svc_loader", "loader");

      return chips;
    }

    function gatherData(){
      return {
        rep_writer: document.getElementById('rep_writer').value.trim(),
        aircraft_type: document.getElementById('aircraft_type').value.trim(),
        arr_date: document.getElementById('arr_date').value,
        arr_time: document.getElementById('arr_time').value,
        dep_date: document.getElementById('dep_date').value,
        dep_time: document.getElementById('dep_time').value,
        stand_num: document.getElementById('stand_num').value.trim(),
        gate_num: document.getElementById('gate_num').value.trim(),
        flight_arr: document.getElementById('flight_arr').value.trim(),
        flight_dep: document.getElementById('flight_dep').value.trim(),

        pax_count: n0('pax_count'),
        delegations_count: n0('delegations_count'),
        vip_pax: n0('vip_pax'),

        movement_staff: getPeople('movement_staff'),
        loading_staff: getPeople('loading_staff'),
        food_staff: getPeople('food_staff'),
        maintenance_staff: getPeople('maintenance_staff'),
        catering_staff: getPeople('catering_staff'),
        sadkoub_staff: getPeople('sadkoub_staff'),

        found_items: document.getElementById('found_items').value.trim(),
        receiver_name: document.getElementById('receiver_name').value.trim(),

        services_chips: gatherServices(),
        light_duration: document.getElementById('light_duration').value.trim(),
        light_stand: document.getElementById('light_stand').value.trim(),
        notes: document.getElementById('notes').value.trim(),
      };
    }

    // Ø¯Ø§Ù„Ø© ØªØ¯Ù…Ø¬ Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø¢Ù„ÙŠØ§Øª Ù…Ø¹ Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø¥Ù†Ø§Ø±Ø©
    function getCombinedChips(d) {
       let chips = [...d.services_chips];
       if (d.light_duration) chips.push(`Ø¥Ù†Ø§Ø±Ø© (Ù…Ø¯Ø©): ${d.light_duration}`);
       if (d.light_stand) chips.push(`Ø¥Ù†Ø§Ø±Ø© (Ù…Ù‡Ø¨Ø·): ${d.light_stand}`);
       if (chips.length === 0) chips.push("â€”");
       return chips;
    }

    const AIRCRAFT_OPTIONS = [
      "Ø§Ù„Ø³ÙˆØ±ÙŠØ©", "ÙÙ„Ø§ÙŠ Ø´Ø§Ù…", "Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠØ©", "Ø§Ù„Ø¬Ø²ÙŠØ±Ø©", "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
      "Ø§Ù„Ù‚Ø·Ø±ÙŠØ©", "Ø§Ù„ØªØ±ÙƒÙŠØ©", "Ø§Ù„ØªØ±ÙƒÙŠØ© Ø£Ø¬ÙŠØª ØµØ¨ÙŠØ­Ø©", "ÙÙ„Ø§ÙŠ Ø¯Ø¨ÙŠ",
      "ÙÙ„Ø§ÙŠ Ù†Ø§Ø³", "ÙÙ„Ø§ÙŠ Ø£Ø¯ÙŠÙ„", "Ø¨ÙˆØ®Ø§Ø±ÙŠØ³Øª", "Ø¥ØºØ§Ø«ÙŠ", "Ø­Ø±Ø¨ÙŠ"
    ];

    function setAircraftType(val){
      const hidden = document.getElementById('aircraft_type');
      const btnText = document.getElementById('aircraft_btn_text');
      hidden.value = (val || "").trim();
      btnText.textContent = hidden.value ? hidden.value : "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©...";
      renderAircraftList(document.getElementById('aircraft_search').value || "");
      applyServiceVisibility(); 
    }

    function renderAircraftList(filterText){
      const list = document.getElementById('aircraft_list');
      const empty = document.getElementById('aircraft_empty');
      const selected = (document.getElementById('aircraft_type').value || "").trim();

      const f = (filterText || "").trim().toLowerCase();
      const items = AIRCRAFT_OPTIONS.filter(x => x.toLowerCase().includes(f));

      list.innerHTML = "";
      if(items.length === 0){
        empty.classList.remove('hidden');
        return;
      }
      empty.classList.add('hidden');

      items.forEach(name => {
        const b = document.createElement('button');
        b.type = "button";
        b.className = "select-item" + (name === selected ? " selected" : "");
        b.setAttribute("role", "option");
        b.setAttribute("aria-selected", name === selected ? "true" : "false");
        b.dataset.value = name;
        b.innerHTML = `<span>${escapeHtml(name)}</span><span class="tick">âœ“</span>`;
        b.onclick = () => {
          setAircraftType(name);
          closeAircraftMenu();
        };
        list.appendChild(b);
      });
    }

    function openAircraftMenu(){
      const wrap = document.getElementById('aircraftSelect');
      const menu = document.getElementById('aircraft_menu');
      const btn = document.getElementById('aircraft_btn');
      wrap.classList.add('open');
      menu.classList.remove('hidden');
      btn.setAttribute("aria-expanded", "true");
      document.getElementById('aircraft_search').focus();
      renderAircraftList(document.getElementById('aircraft_search').value || "");
    }

    function closeAircraftMenu(){
      const wrap = document.getElementById('aircraftSelect');
      const menu = document.getElementById('aircraft_menu');
      const btn = document.getElementById('aircraft_btn');
      wrap.classList.remove('open');
      menu.classList.add('hidden');
      btn.setAttribute("aria-expanded", "false");
    }

    function toggleAircraftMenu(){
      const menu = document.getElementById('aircraft_menu');
      if(menu.classList.contains('hidden')) openAircraftMenu();
      else closeAircraftMenu();
    }

    function initAircraftSelect(){
      const btn = document.getElementById('aircraft_btn');
      const search = document.getElementById('aircraft_search');
      btn.addEventListener('click', toggleAircraftMenu);
      search.addEventListener('input', (e) => { renderAircraftList(e.target.value || ""); });
      document.addEventListener('keydown', (e) => { if(e.key === "Escape") closeAircraftMenu(); });
      document.addEventListener('click', (e) => {
        const wrap = document.getElementById('aircraftSelect');
        if(!wrap.contains(e.target)) closeAircraftMenu();
      });
      setAircraftType("");
      closeAircraftMenu();
    }

    function safeText(x){ return (x && x.toString().trim()) ? x.toString().trim() : "â€”"; }

    function buildPdfTemplateHtml(d){
      const createdStr = new Date().toLocaleString('ar');
      const allChipsHtml = getCombinedChips(d).map(s => `<span class="pdfChip">${escapeHtml(s)}</span>`).join("");
      const staffRows = getVerticalStaffRows(d);

      return `
        <div class="pdfPage">
          <div class="pdfHeader">
            <div style="display:flex; align-items:center; gap:16px;">
              <img src="logo.png" onerror="this.style.display='none'" style="width:65px; height:65px; object-fit:contain; border-radius:12px; background:rgba(255,255,255,.1); padding:6px;">
              <div>
                <div style="font-weight:900; font-size:14px; opacity:.92; margin-bottom:4px;">Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</div>
                <h1>ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ø­Ø© Ø§Ù„Ø·ÙŠØ±Ø§Ù† - Ø®Ø¯Ù…Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</h1>
                <div class="sub">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${escapeHtml(createdStr)}</div>
              </div>
            </div>
            <div class="pdfBadge">ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ${escapeHtml(safeText(d.rep_writer))}</div>
          </div>

          <div class="pdfGrid">
            <div class="pdfCard">
              <div class="pdfCardTitle">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©</div>
              <div class="pdfCardBody">
                <table class="pdfTable">
                  <tr>
                    <td class="k" style="width:20%;">Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</td><td class="v" style="width:30%;">${escapeHtml(safeText(d.aircraft_type))}</td>
                    <td class="k" style="width:20%;">Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨</td><td class="v" style="width:30%;">${escapeHtml(d.pax_count)}</td>
                  </tr>
                  <tr>
                    <td class="k">ÙˆÙÙˆØ¯</td><td class="v">${escapeHtml(d.delegations_count)}</td>
                    <td class="k">Ø±ÙƒØ§Ø¨ VIP</td><td class="v">${escapeHtml(d.vip_pax)}</td>
                  </tr>
                  <tr>
                    <td class="k">ØªÙˆÙ‚ÙŠØª Ø§Ù„ÙˆØµÙˆÙ„</td><td class="v" style="direction:ltr; text-align:right;">${escapeHtml(safeText(d.arr_time))} / ${escapeHtml(safeText(d.arr_date))}</td>
                    <td class="k">ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©</td><td class="v" style="direction:ltr; text-align:right;">${escapeHtml(safeText(d.dep_time))} / ${escapeHtml(safeText(d.dep_date))}</td>
                  </tr>
                  <tr>
                    <td class="k">Ù…Ù‡Ø¨Ø· Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</td><td class="v">ÙÙ†ÙƒØ± ${escapeHtml(safeText(d.stand_num))} â€” Ø¨ÙˆØ§Ø¨Ø© ${escapeHtml(safeText(d.gate_num))}</td>
                    <td class="k">Ø±Ù‚Ù… Ø§Ù„Ø±Ø­Ù„Ø©</td><td class="v">Ù‚Ø¯ÙˆÙ… ${escapeHtml(safeText(d.flight_arr))} â€” Ù…ØºØ§Ø¯Ø±Ø© ${escapeHtml(safeText(d.flight_dep))}</td>
                  </tr>
                </table>
              </div>
            </div>

            <div class="pdfCard">
              <div class="pdfCardTitle">Ø§Ù„Ø·ÙˆØ§Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
              <div class="pdfCardBody">
                <table class="pdfTable" style="text-align:center;">
                  <tr style="background:#f8fafc;">
                    <td class="k" style="width:16.6%;">Ù…ÙˆØ¸Ù Ø§Ù„Ø­Ø±ÙƒØ©</td>
                    <td class="k" style="width:16.6%;">Ø¹Ù…Ø§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</td>
                    <td class="k" style="width:16.6%;">Ø¶ÙŠØ§ÙØ© Ø¬ÙˆÙŠØ©</td>
                    <td class="k" style="width:16.6%;">Ø¹Ù…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©</td>
                    <td class="k" style="width:16.6%;">Ø¹Ù…Ø§Ù„ Ø§Ù„ÙƒØ§ØªØ±ÙŠÙ†Øº</td>
                    <td class="k" style="width:16.6%;">Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³Ø§Ø¯ÙƒÙˆØ¨</td>
                  </tr>
                  ${staffRows.length === 0 ? `<tr><td colspan="6" class="v">â€”</td></tr>` : staffRows.map(r => `
                    <tr>
                      <td class="v" style="font-size:14px;">${escapeHtml(r.movement)}</td>
                      <td class="v" style="font-size:14px;">${escapeHtml(r.loading)}</td>
                      <td class="v" style="font-size:14px;">${escapeHtml(r.food)}</td>
                      <td class="v" style="font-size:14px;">${escapeHtml(r.maintenance)}</td>
                      <td class="v" style="font-size:14px;">${escapeHtml(r.catering)}</td>
                      <td class="v" style="font-size:14px;">${escapeHtml(r.sadkoub)}</td>
                    </tr>
                  `).join('')}
                </table>

                <div style="margin-top:20px;">
                  <table class="pdfTable">
                    <tr>
                      <td class="k" style="width:20%;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</td>
                      <td class="v" style="width:80%;">${escapeHtml(safeText(d.receiver_name))}</td>
                    </tr>
                  </table>
                  <div style="margin-top:14px;">
                    <div style="font-weight:900; color:#0f172a; font-size:14px; margin-bottom:6px;">Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø§Øª Ø§Ù„ØªÙŠ ÙˆÙØ¬Ø¯Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©</div>
                    <div class="pdfNotes">${escapeHtml(safeText(d.found_items))}</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="pdfCard">
              <div class="pdfCardTitle">Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„Ø¥Ù†Ø§Ø±Ø©</div>
              <div class="pdfCardBody">
                <div class="pdfChips">${allChipsHtml}</div>
                <div style="margin-top:14px;">
                  <div style="font-weight:900; color:#0f172a; font-size:14px; margin-bottom:6px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
                  <div class="pdfNotes">${escapeHtml(safeText(d.notes))}</div>
                </div>
              </div>
            </div>

          </div>
        </div>
      `;
    }

    async function exportPdfPro(){
      const btn = document.getElementById('exportPdfBtn');
      const old = btn.innerText;
      btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF...";
      btn.disabled = true;

      try{
        const d = gatherData();
        const pdfPage = document.getElementById('pdfPage');
        pdfPage.innerHTML = buildPdfTemplateHtml(d);

        let flightName = "";
        if (d.flight_arr && d.flight_dep) flightName = `${d.flight_arr}_${d.flight_dep}`;
        else if (d.flight_arr) flightName = d.flight_arr;
        else if (d.flight_dep) flightName = d.flight_dep;
        else flightName = `Ramp_Report_${new Date().toISOString().slice(0,10)}`;

        flightName = flightName.replace(/[\/\\:*?"<>|\s]/g, '-');
        const fileName = `${flightName}.pdf`;

        const opt = {
          margin: [10, 10, 10, 10], 
          filename: fileName,
          image: { type: 'jpeg', quality: 1.0 }, 
          html2canvas: {
            scale: 2, 
            useCORS: true,
            windowWidth: 1100, // Ù…Ù†Ø¹ Ø§Ù„Ù‚Øµ Ø¨Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª 
            scrollY: 0, 
            x: 0
          },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },
          pagebreak: { mode: ['css', 'legacy'] } 
        };

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù€ PDF Ø¥Ù„Ù‰ Blob Ø«Ù… Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ø£Ùˆ ØªÙ†Ø²ÙŠÙ„Ù‡ ÙƒØ¨Ø¯ÙŠÙ„
        await html2pdf().set(opt).from(pdfPage).toPdf().get('pdf').then(async function (pdfObj) {
          const pdfBlob = pdfObj.output('blob');
          const fileForShare = new File([pdfBlob], fileName, { type: 'application/pdf' });

          if (navigator.canShare && navigator.canShare({ files: [fileForShare] })) {
            try {
              await navigator.share({
                title: 'ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ø­Ø© Ø§Ù„Ø·ÙŠØ±Ø§Ù†',
                text: 'Ù…Ø±ÙÙ‚ ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ø­Ø© Ø§Ù„Ø·ÙŠØ±Ø§Ù† Ø¨ØµÙŠØºØ© PDF.',
                files: [fileForShare]
              });
            } catch (error) {
              if (error.name !== 'AbortError') saveAs(pdfBlob, fileName);
            }
          } else {
            saveAs(pdfBlob, fileName);
          }
        });

      }catch(e){
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± PDF: " + (e?.message || e));
      }finally{
        btn.innerText = old;
        btn.disabled = false;
      }
    }

    // ===== DOCX Native Export =====
    async function exportDocxNative(){
      const btn = document.getElementById('exportWordBtn');
      const oldText = btn.innerText;
      btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ²...";
      btn.disabled = true;

      try {
        const d = gatherData();
        const docx = window.docx;
        const {
          Document, Packer, Paragraph, TextRun, AlignmentType,
          Table, TableRow, TableCell, WidthType, BorderStyle, ShadingType,
          PageOrientation, ImageRun
        } = docx;

        const rtl = true;
        const createdStr = new Date().toLocaleString('ar');

        async function loadLogoBytes(){
          try{
            const res = await fetch("logo.png", { cache: "no-store" });
            if(!res.ok) throw new Error("logo fetch failed");
            const buf = await res.arrayBuffer();
            return new Uint8Array(buf);
          }catch(e){
            return null;
          }
        }
        const logoBytes = await loadLogoBytes();

        const run = (text, opt={}) => new TextRun({ text: text ?? "", bold: !!opt.bold, size: opt.size ?? 24, color: opt.color });
        const p = (runsOrText, opt={}) => {
          const children = Array.isArray(runsOrText) ? runsOrText : [run(runsOrText, opt.run || {})];
          return new Paragraph({
            children, alignment: opt.align ?? AlignmentType.RIGHT,
            bidirectional: rtl, spacing: { before: opt.before ?? 60, after: opt.after ?? 60 },
          });
        };

        const cell = (children, opt={}) => new TableCell({
          children: Array.isArray(children) ? children : [p(children)],
          width: opt.width ? { size: opt.width, type: WidthType.PERCENTAGE } : undefined,
          shading: opt.fill ? { type: ShadingType.CLEAR, color: "auto", fill: opt.fill } : undefined,
          margins: { top: 120, bottom: 120, left: 140, right: 140 },
          columnSpan: opt.colSpan
        });

        const borders = {
          top:    { style: BorderStyle.SINGLE, size: 8, color: "B9A779" },
          bottom: { style: BorderStyle.SINGLE, size: 8, color: "B9A779" },
          left:   { style: BorderStyle.SINGLE, size: 8, color: "B9A779" },
          right:  { style: BorderStyle.SINGLE, size: 8, color: "B9A779" },
          insideHorizontal: { style: BorderStyle.SINGLE, size: 6, color: "E6E6E6" },
          insideVertical:   { style: BorderStyle.SINGLE, size: 6, color: "E6E6E6" },
        };

        const rowTitle = (title, colSpan=4) => new TableRow({
          children: [
            new TableCell({
              children: [p([run(title, {bold:true, size:26, color:"FFFFFF"})], {align: AlignmentType.RIGHT})],
              columnSpan: colSpan,
              shading: { type: ShadingType.CLEAR, color: "auto", fill: "0B2F2A" },
              margins: { top: 140, bottom: 140, left: 140, right: 140 },
            })
          ],
        });

        const row2 = (k1, v1, k2, v2) => new TableRow({
          children: [
            cell([p([run(k1, {bold:true, color:"0B2F2A"})])], { width: 15, fill: "F6F2E8" }),
            cell([p([run((v1 ?? "â€”").toString(), {color:"111111"})])], { width: 35 }),
            cell([p([run(k2, {bold:true, color:"0B2F2A"})])], { width: 15, fill: "F6F2E8" }),
            cell([p([run((v2 ?? "â€”").toString(), {color:"111111"})])], { width: 35 }),
          ],
        });

        const rowWide = (k, v) => new TableRow({
          children: [
            cell([p([run(k, {bold:true, color:"0B2F2A"})])], { width: 20, fill: "F6F2E8" }),
            cell([p([run((v ?? "â€”").toString(), {color:"111111"})])], { width: 80, colSpan: 3 })
          ],
        });

        const headerLogoCell = logoBytes
          ? cell([
              new Paragraph({
                bidirectional: rtl, alignment: AlignmentType.RIGHT,
                children: [ new ImageRun({ data: logoBytes, transformation: { width: 72, height: 72 } }) ],
                spacing: { before: 0, after: 0 }
              })
            ], { width: 20 })
          : cell([p("")], { width: 20 });

        const headerTextCell = cell([
          p([run("ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ø­Ø© Ø§Ù„Ø·ÙŠØ±Ø§Ù† - Ø®Ø¯Ù…Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø©", {bold:true, size:34, color:"0B2F2A"})], {align: AlignmentType.RIGHT, after: 40}),
          p([run("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: " + createdStr, {size:20, color:"444444"})], {align: AlignmentType.RIGHT, before: 0, after: 0}),
        ], { width: 80 });

        const headerTable = new Table({
          width: { size: 100, type: WidthType.PERCENTAGE },
          borders: {
            top:    { style: BorderStyle.NONE, size: 0, color: "FFFFFF" },
            bottom: { style: BorderStyle.NONE, size: 0, color: "FFFFFF" },
            left:   { style: BorderStyle.NONE, size: 0, color: "FFFFFF" },
            right:  { style: BorderStyle.NONE, size: 0, color: "FFFFFF" },
            insideHorizontal: { style: BorderStyle.NONE, size: 0, color: "FFFFFF" },
            insideVertical:   { style: BorderStyle.NONE, size: 0, color: "FFFFFF" },
          },
          rows: [ new TableRow({ children: [headerTextCell, headerLogoCell] }) ]
        });

        // Flight Data Table
        const part1 = new Table({
          width: { size: 100, type: WidthType.PERCENTAGE },
          borders,
          rows: [
            rowTitle("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©", 4),
            row2("ÙƒØ§ØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±", d.rep_writer || "â€”", "Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©", d.aircraft_type || "â€”"),
            row2("ØªÙˆÙ‚ÙŠØª Ø§Ù„ÙˆØµÙˆÙ„", `${d.arr_time || "â€”"} / ${d.arr_date || "â€”"}`, "ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©", `${d.dep_time || "â€”"} / ${d.dep_date || "â€”"}`),
            row2("Ø±Ù‚Ù… Ø§Ù„ÙÙ†ÙƒØ±", d.stand_num || "â€”", "Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©", d.gate_num || "â€”"),
            row2("Ø±Ø­Ù„Ø© Ù‚Ø¯ÙˆÙ…", d.flight_arr || "â€”", "Ø±Ø­Ù„Ø© Ù…ØºØ§Ø¯Ø±Ø©", d.flight_dep || "â€”"),
            row2("Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨", d.pax_count.toString(), "ÙˆÙÙˆØ¯", d.delegations_count.toString()),
            rowWide("Ø±ÙƒØ§Ø¨ VIP", d.vip_pax.toString()),
          ],
        });

        // Staff Table (Vertical format 6 columns)
        const staffHeaderRow = new TableRow({
          children: [
            cell([p([run("Ù…ÙˆØ¸Ù Ø§Ù„Ø­Ø±ÙƒØ©", {bold:true, color:"0B2F2A"})], {align: AlignmentType.CENTER})], { width: 16.6, fill: "F6F2E8" }),
            cell([p([run("Ø¹Ù…Ø§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„", {bold:true, color:"0B2F2A"})], {align: AlignmentType.CENTER})], { width: 16.6, fill: "F6F2E8" }),
            cell([p([run("Ø¶ÙŠØ§ÙØ© Ø¬ÙˆÙŠØ©", {bold:true, color:"0B2F2A"})], {align: AlignmentType.CENTER})], { width: 16.6, fill: "F6F2E8" }),
            cell([p([run("Ø¹Ù…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©", {bold:true, color:"0B2F2A"})], {align: AlignmentType.CENTER})], { width: 16.6, fill: "F6F2E8" }),
            cell([p([run("Ø¹Ù…Ø§Ù„ Ø§Ù„ÙƒØ§ØªØ±ÙŠÙ†Øº", {bold:true, color:"0B2F2A"})], {align: AlignmentType.CENTER})], { width: 16.6, fill: "F6F2E8" }),
            cell([p([run("Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³Ø§Ø¯ÙƒÙˆØ¨", {bold:true, color:"0B2F2A"})], {align: AlignmentType.CENTER})], { width: 16.6, fill: "F6F2E8" }),
          ]
        });

        const vRows = getVerticalStaffRows(d);
        const staffDataRows = vRows.map(r => new TableRow({
          children: [
            cell([p([run(r.movement, {color:"111111"})], {align: AlignmentType.CENTER})], { width: 16.6 }),
            cell([p([run(r.loading, {color:"111111"})], {align: AlignmentType.CENTER})], { width: 16.6 }),
            cell([p([run(r.food, {color:"111111"})], {align: AlignmentType.CENTER})], { width: 16.6 }),
            cell([p([run(r.maintenance, {color:"111111"})], {align: AlignmentType.CENTER})], { width: 16.6 }),
            cell([p([run(r.catering, {color:"111111"})], {align: AlignmentType.CENTER})], { width: 16.6 }),
            cell([p([run(r.sadkoub, {color:"111111"})], {align: AlignmentType.CENTER})], { width: 16.6 }),
          ]
        }));

        if(staffDataRows.length === 0){
           staffDataRows.push(new TableRow({ children: [cell([p([run("â€”")], {align: AlignmentType.CENTER})], {colSpan: 6})] }));
        }

        const staffTable = new Table({
          width: { size: 100, type: WidthType.PERCENTAGE },
          borders,
          rows: [
            rowTitle("Ø§Ù„Ø·ÙˆØ§Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†", 6),
            staffHeaderRow,
            ...staffDataRows
          ]
        });

        const foundItemsTable = new Table({
          width: { size: 100, type: WidthType.PERCENTAGE },
          borders,
          rows: [
            rowTitle("Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø§Øª ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù…", 2),
            new TableRow({
              children: [
                cell([p([run("Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø§Øª Ø§Ù„ØªÙŠ ÙˆÙØ¬Ø¯Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©", {bold:true, color:"0B2F2A"})])], { width: 25, fill: "F6F2E8" }),
                cell([p([run(d.found_items || "â€”", {color:"111111"})])], { width: 75 })
              ]
            }),
            new TableRow({
              children: [
                cell([p([run("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…", {bold:true, color:"0B2F2A"})])], { width: 25, fill: "F6F2E8" }),
                cell([p([run(d.receiver_name || "â€”", {color:"111111"})])], { width: 75 })
              ]
            })
          ]
        });

        const allChipsText = getCombinedChips(d).join(" ØŒ ");
        const part3Rows = [
            rowTitle("Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„Ø¥Ù†Ø§Ø±Ø©", 4),
            rowWide("Ø§Ù„Ø¢Ù„ÙŠØ§Øª", allChipsText),
            rowWide("Ù…Ù„Ø§Ø­Ø¸Ø§Øª", d.notes || "â€”")
        ];

        const part3 = new Table({ width: { size: 100, type: WidthType.PERCENTAGE }, borders, rows: part3Rows });

        const doc = new Document({
          sections: [{
            properties: {
              page: { size: { orientation: PageOrientation.LANDSCAPE }, margin: { top: 900, bottom: 900, left: 900, right: 900 } }
            },
            children: [ 
              headerTable, 
              p(" ", {after: 120}), part1, 
              p(" ", {after: 120}), staffTable, 
              p(" ", {after: 120}), foundItemsTable, 
              p(" ", {after: 120}), part3 
            ]
          }]
        });

        const blob = await Packer.toBlob(doc);

        let flightName = "";
        if (d.flight_arr && d.flight_dep) flightName = `${d.flight_arr}_${d.flight_dep}`;
        else if (d.flight_arr) flightName = d.flight_arr;
        else if (d.flight_dep) flightName = d.flight_dep;
        else flightName = `Ramp_Report_${new Date().toISOString().slice(0,10)}`;

        flightName = flightName.replace(/[\/\\:*?"<>|\s]/g, '-');
        const fileName = `${flightName}.docx`;
        const fileForShare = new File([blob], fileName, { type: blob.type });

        if (navigator.canShare && navigator.canShare({ files: [fileForShare] })) {
          try {
            await navigator.share({ title: 'ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ø­Ø© Ø§Ù„Ø·ÙŠØ±Ø§Ù†', text: 'Ù…Ø±ÙÙ‚ ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ø­Ø© Ø§Ù„Ø·ÙŠØ±Ø§Ù† Ø¨ØµÙŠØºØ© Word.', files: [fileForShare] });
          } catch (error) {
            if (error.name !== 'AbortError') saveAs(blob, fileName);
          }
        } else {
          saveAs(blob, fileName);
        }

      } catch (error) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±: " + error.message);
      } finally {
        btn.innerText = oldText;
        btn.disabled = false;
      }
    }

    function resetForm(){
      const idsToClear = [
        'rep_writer','aircraft_type','arr_time','arr_date','dep_time','dep_date',
        'stand_num','gate_num','flight_arr','flight_dep','pax_count',
        'delegations_count','vip_pax','found_items','receiver_name',
        'light_duration','light_stand','notes',
        'svc_belt_stairs_qty','svc_stairs_qty','svc_carts_qty','svc_charge_qty','svc_tractor_qty'
      ];
      idsToClear.forEach(id => { const el = document.getElementById(id); if(el) el.value=''; });

      setAircraftType("");

      [
        'svc_lift','svc_catering1','svc_compressor','svc_battery','svc_salt_water','svc_fresh_water',
        'svc_fire','svc_sad_cup','svc_ac','svc_pushback','svc_loader'
      ].forEach(id => { const el=document.getElementById(id); if(el) el.checked=false; });

      ['movement_staff','loading_staff','food_staff','maintenance_staff','catering_staff','sadkoub_staff']
        .forEach(cid => document.getElementById(cid).innerHTML='');

      addPerson('movement_staff'); addPerson('loading_staff'); addPerson('food_staff');
      addPerson('maintenance_staff'); addPerson('catering_staff'); addPerson('sadkoub_staff');

      setTodayDefaults();
      applyServiceVisibility();
    }

    window.onload = function(){
      setTodayDefaults();
      initAircraftSelect();
      applyServiceVisibility();

      addPerson('movement_staff'); addPerson('loading_staff'); addPerson('food_staff');
      addPerson('maintenance_staff'); addPerson('catering_staff'); addPerson('sadkoub_staff');
    };
  </script>
</body>
</html>